<!DOCTYPE html>
<html>
  <head>
    <title>Magnitude pilot experiment</title>
    <script src="https://unpkg.com/jspsych"></script>
    <script src="https://unpkg.com/@jspsych/plugin-html-keyboard-response"></script>
    <script src="https://unpkg.com/@jspsych/plugin-html-button-response"></script>
    <script src="https://unpkg.com/@jspsych/plugin-canvas-keyboard-response"></script>
    <script src="https://unpkg.com/@jspsych/plugin-canvas-button-response"></script>
    <script src="https://unpkg.com/@jspsych/plugin-image-button-response"></script>
    <script src="https://unpkg.com/@jspsych/plugin-preload"></script>
    <link href="https://unpkg.com/jspsych/css/jspsych.css" rel="stylesheet" type="text/css">
    <script src="canvasMorpher.js"></script>


    <link href="https://unpkg.com/jspsych/css/jspsych.css" rel="stylesheet" type="text/css" />

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
      .jspsych-btn { padding: 1px 20px;
      font-size: 20px;
      border-color: black;
      }
    </style>

  </head>
  <body></body>

  <script>


  /* initialize jsPsych */
  var jsPsych = initJsPsych({
    on_finish: function() {
      var csv = jsPsych.data.get().csv();
      var filename = "trial.csv";
      jsPsych.data.get().localSave('csv','mydata.csv');
    }
  });

    /* Instructions */
    /* welcome message */
    var welcome = {
      type: jsPsychHtmlKeyboardResponse,
      stimulus: `<p style="font-size:20px;font-weight:bold;"> Thank you for your participation! </p> <p> (Press any key to begin.)</p>`
    };

    /* closing message */
    var closing = {
      type: jsPsychHtmlKeyboardResponse,
      stimulus: "<p> Thank you very much again for your participation! We sincerely appreciate your time and effort.</p> <p>You can close your window whenever you feel comfortable.</p>"
    };

    /* instruction for learning phase_1 */
    // Passive learning
    var instruction_1 = {
      type: jsPsychHtmlKeyboardResponse,
      stimulus: `
        <p> In this section, <br />
        You will <strong>compare pairs of images </strong> which appear in the center of the screen.<br />
        Below each image will be <strong> a statement that describes it </strong>. <br/>
        <p> (Press any key to begin.) </p>
      `,
      post_trial_gap: 500
    };

    // Active learning
    var instruction_2 = {
      type: jsPsychHtmlKeyboardResponse,
      stimulus: `
        <p> In this section, <br />
        you will continue to <strong>compare pairs of images</strong>. <br/>
        However, you will now be asked to <strong>choose the correct description</strong> for the <strong>second</strong> image.</p>
        (Press any key to continue.)
      `,
      /* I am deliberately not telling them that they will be given limitless chances until they get it right -- just so they can pay more attention.*/
      post_trial_gap: 500
    };

    /* instruction for testing phase_1 */
    var instruction_3 = {
      type: jsPsychHtmlKeyboardResponse,
      stimulus: `
        <p> <strong>Great Job!</strong> </p>
        <p> Continue answering our questions by <strong>selecting the correct description</strong> for the <strong>second</strong> image.</br> However, we are no longer telling you if you\`ve got the right answer!</p>
        <p> (Press any key to continue.)</p>
      `,
      post_trial_gap: 500
    };

    /* instruction for learning phase_2 */
    //Passive
    var instruction_4 = {
      type: jsPsychHtmlKeyboardResponse,
      stimulus: `
        <p> <strong>Perfect!</strong> </p>
        <p> You will continue to see pairs of images accompanied by the description.
        <br/> This time, we are giving you more detailed description, using <strong>our own mysterious scale</strong>... </p>
        <p>(Press any key to continue.)</p>
      `,
      post_trial_gap: 500
    };

    //Active
    var instruction_5 = {
      type: jsPsychHtmlKeyboardResponse,
      stimulus: `
        <p> <strong>Awesome!</strong> <br/>
        Now, we would like to ask you to choose the <strong>correct statement for the second image</strong>.</p>
        Press any key to continue.
      `,
      post_trial_gap: 500
    };

    /* instruction for testing phase_2a */
    var instruction_6 = {
      type: jsPsychHtmlKeyboardResponse,
      stimulus: `
        <p> <strong>Great Job!</strong> </p>
        <p> We're going to give you one set of questions.<br/> However, we are <strong>no longer</strong> telling you if you\`ve got the right answer!</p>
        <p> Press any key to continue.</p>
      `,
      post_trial_gap: 500
    };

    /* instruction for testing phase_2b */
    var instruction_7 = {
      type: jsPsychHtmlKeyboardResponse,
      stimulus: `
        <p> <strong>Excellent!</strong> </p>
        <p> We're going to give you one last set of questions.<br/> This time you will be asked to choose from <strong>different descriptive options</strong>!</p>
        <p> Press any key to continue.</p>
      `,
      post_trial_gap: 500
    };

    /* instruction for testing phase_2b */
    var instruction_8 = {
      type: jsPsychHtmlKeyboardResponse,
      stimulus: `
        <p> <strong>Great job!</strong> </p>
        <p> This is the last part of the experiment.<br/> This time you will be asked to choose from <strong>different descriptive options</strong> with some familiar concepts!</p>
        <p> Press any key to continue.</p>
      `,
      post_trial_gap: 500
    };

     /* Fixation */
    var fixation = {
      type: jsPsychHtmlKeyboardResponse,
      stimulus: `<div style="font-size:60px;">+</div>`,
      choices: "NO_KEYS",
      trial_duration: 500,
      data: {
        task: `fixation`
      }
    };
    var instruction_break = {
      type: jsPsychHtmlKeyboardResponse,
      stimulus: `
        <p style="font-size:20px;font-weight:bold;"> Look at this pair! </p>
        <p> (Press any key when you are ready.)</p>
      `,
    };


    // frimble vs. orpital
    var A = `frimble`;
    var B = `orpital`;

    /* Stimuli : low precision condition */
    /* Stimuli for learning_phase_1A */
    var learn_stimuli_a1 = [
        { stimulus: "1", radius_a: .05, name_a: `Compared to this...<br/> .`, radius_b: .80, prompt: `<p style="font-size:20px;font-weight:bold;"> Compared to the left one, the right one is more ${B}.</p> <br /> (Press any key to continue to the next image.)` },
        { stimulus: "2", radius_a: .95, name_a: `Compared to this...<br/> .`,radius_b: .35, prompt: `<p style="font-size:20px;font-weight:bold;"> Compared to the left one, the right one is more ${A}. </p><br /> (Press any key to continue to the next image.)` },
        { stimulus: "3", radius_a: .10,name_a: `Compared to this...<br/> .`,radius_b: .55, prompt: `<p style="font-size:20px;font-weight:bold;"> Compared to the left one, the right one is more ${B}.</p> <br /> (Press any key to continue to the next image.)` },
        { stimulus: "4", radius_a: .35,name_a: `Compared to this...<br/> .`,radius_b: .20, prompt: `<p style="font-size:20px;font-weight:bold;"> Compared to the left one, the right one is more ${A}. </p><br /> (Press any key to continue to the next image.)` },
        { stimulus: "5", radius_a: .55,name_a: `Compared to this...<br/> .`,radius_b: .55, prompt: `<p style="font-size:20px;font-weight:bold;"> They are equal. </p><br /> (Press any key to continue to the next image.)` },
      ];
    /* Stimuli for learning_phase_1B */
    var learn_stimuli_a2 = [
        { stimulus: "6", radius_a: .30,name_a: `Compared to this...`,radius_b: .90, prompt: `<p style="font-size:20px;font-weight:bold;"> Compared to the left one, the right one is more ${B}.</p>`, correct_response:1 },
        { stimulus: "7", radius_a: .20,name_a: `Compared to this...`,radius_b: .20, prompt: `<p style="font-size:20px;font-weight:bold;"> They are equal.</p>`,correct_response:2},
        { stimulus: "8", radius_a: .25,name_a: `Compared to this...`,radius_b: .10, prompt: `<p style="font-size:20px;font-weight:bold;"> Compared to the left one, the right one is more ${A}.</p>`,correct_response:0 },
        { stimulus: "9", radius_a: .30,name_a: `Compared to this...`,radius_b: .75, prompt: `<p style="font-size:20px;font-weight:bold;"> Compared to the left one, the right one is more ${B}.</p>`,correct_response:1 },
        { stimulus: "10", radius_a: .90,name_a: `Compared to this...`,radius_b: .30, prompt: `<p style="font-size:20px;font-weight:bold;"> Compared to the left one, the right one is more ${A}.</p>`,correct_response:0 },
      ];

    /* Stimuli for learning_phase_1B */
    var learn_stimuli_c1 = [
        { stimulus: "1", radius_a: .05, name_a: `Compared to this...<br/> .`, radius_b: .80, prompt: `<p style="font-size:20px;font-weight:bold;">Compared to the left one, the right one is 5 degrees more ${B}. </p><br />(Press any key to continue to the next image.)` },//75
        { stimulus: "3", radius_a: .10,name_a: `Compared to this...<br/> .`,radius_b: .55, prompt: `<p style="font-size:20px;font-weight:bold;">Compared to the left one, the right one is 3 degrees more ${B}. </p><br />(Press any key to continue to the next image.)` },//45
        { stimulus: "4", radius_a: .35,name_a: `Compared to this...<br/> .`,radius_b: .20, prompt: `<p style="font-size:20px;font-weight:bold;">Compared to the left one, the right one is 1 degrees more ${A}. </p><br />(Press any key to continue to the next image.)` },//15
        { stimulus: "2", radius_a: .95, name_a: `Compared to this...<br/> .`,radius_b: .35, prompt: `<p style="font-size:20px;font-weight:bold;">Compared to the left one, the right one is 4 degrees more ${A}. </p><br />(Press any key to continue to the next image.)` },//60
        { stimulus: "5", radius_a: .55,name_a: `Compared to this...<br/> .`,radius_b: .55, prompt: `<p style="font-size:20px;font-weight:bold;">They are equal. </p><br />Press any key to continue to the next image.` },//0
      ];
   var learn_stimuli_c2 = [
        { stimulus: "6", radius_a: .30,name_a: `Compared to this...`,radius_b: .90, prompt: `<p style="font-size:20px;font-weight:bold;">From 0 to 4, how many degrees is the right one more ${B}?</p>`, correct_response:4 },//60
        { stimulus: "7", radius_a: .20,name_a: `Compared to this...`,radius_b: .20, prompt: `<p style="font-size:20px;font-weight:bold;">From 0 to 4, how many degrees is the right one more ${B}?</p>`,correct_response:0},//0
        { stimulus: "8", radius_a: .25,name_a: `Compared to this...`,radius_b: .10, prompt: `<p style="font-size:20px;font-weight:bold;">From 0 to 4, how many degrees is the right one more ${A}?</p>`,correct_response:1 },//15
        { stimulus: "9", radius_a: .30,name_a: `Compared to this...`,radius_b: .75, prompt: `<p style="font-size:20px;font-weight:bold;">From 0 to 4, how many degrees is the right one more ${B}?</p>`,correct_response:3},//45
        { stimulus: "10", radius_a: .90,name_a: `Compared to this...`,radius_b: .30, prompt: `<p style="font-size:20px;font-weight:bold;">From 0 to 4, how many degrees is the right one more ${A}?</p>`,correct_response:4},//60
      ];

    /* Stimuli for testing_phase */
    var test_stimuli = [
      { stimulus: "1", radius_a: .05, prompt: `Compared to this...`, radius_b: .70, key_prompt: `Compared to this, this is more B.`, correct_response:1  },
      { stimulus: "2", radius_a: .95, prompt: `Compared to this...`,radius_b: .45, key_prompt: `Compared to this, this is more A.` , correct_response:0 },
      { stimulus: "3", radius_a: .20,prompt: `Compared to this...`,radius_b: .55, key_prompt: `Compared to this, this is more B.` , correct_response:1 },
      { stimulus: "4", radius_a: .35,prompt: `Compared to this...`,radius_b: .30, key_prompt: `Compared to this, this is more A.` ,correct_response:0 },
      { stimulus: "5", radius_a: .55,prompt: `Compared to this...`,radius_b: .55, key_prompt: `They are equal.` ,correct_response:2 },
      { stimulus: "6", radius_a: .40,prompt: `Compared to this...`,radius_b: .90, key_prompt: `Compared to this, this is more B.`, correct_response:1 },
      { stimulus: "7", radius_a: .20,prompt: `Compared to this...`,radius_b: .20, key_prompt: `They are equal.`,correct_response:2},
      { stimulus: "8", radius_a: .15,prompt: `Compared to this...`,radius_b: .10, key_prompt: `Compared to this, this is more A.`,correct_response:0 },
      { stimulus: "9", radius_a: .30,prompt: `Compared to this...`,radius_b: .65, key_prompt: `Compared to this, this is more B.`,correct_response:1 },
      { stimulus: "10", radius_a: .80,prompt: `Compared to this...`,radius_b: .30, key_prompt: `Compared to this, this is more A.`,correct_response:0 },
      ];

      var test_stimuli_2 = [
        { stimulus: "1", radius_a: .05, prompt: `Compared to this...`, radius_b: .70, key_prompt: `Compared to this, this is more B.`, correct_response:1  },
        { stimulus: "2", radius_a: .95, prompt: `Compared to this...`,radius_b: .45, key_prompt: `Compared to this, this is more A.` , correct_response:0 },
        { stimulus: "3", radius_a: .20,prompt: `Compared to this...`,radius_b: .55, key_prompt: `Compared to this, this is more B.` , correct_response:1 },
        { stimulus: "4", radius_a: .35,prompt: `Compared to this...`,radius_b: .30, key_prompt: `Compared to this, this is more A.` ,correct_response:0 },
        { stimulus: "5", radius_a: .55,prompt: `Compared to this...`,radius_b: .55, key_prompt: `They are equal.` ,correct_response:2 },
        { stimulus: "6", radius_a: .40,prompt: `Compared to this...`,radius_b: .90, key_prompt: `Compared to this, this is more B.`, correct_response:1 },
        { stimulus: "7", radius_a: .20,prompt: `Compared to this...`,radius_b: .20, key_prompt: `They are equal.`,correct_response:2},
        { stimulus: "8", radius_a: .15,prompt: `Compared to this...`,radius_b: .10, key_prompt: `Compared to this, this is more A.`,correct_response:0 },
        { stimulus: "9", radius_a: .30,prompt: `Compared to this...`,radius_b: .65, key_prompt: `Compared to this, this is more B.`,correct_response:1 },
        { stimulus: "10", radius_a: .80,prompt: `Compared to this...`,radius_b: .30, key_prompt: `Compared to this, this is more A.`,correct_response:0 },
        ];

      var test_stimuli_3 = [
        { stimulus: 'img/tall1.png', word: "tall", antonym: "short"},
        { stimulus: 'img/tall2.png', word: "tall", antonym: "short"},
        { stimulus: 'img/tall3.png', word: "tall", antonym: "short"},
        { stimulus: 'img/dark1.png', word: "dark", antonym: "light"},
        { stimulus: 'img/dark2.png', word: "dark", antonym: "light"},
        { stimulus: 'img/dark3.png', word: "dark", antonym: "light"},
        ];


    /* Function for generating canvas stimuli */
    function Morphfunction(canvas, p1, p2){
        const canvasMorpher = new CanvasMorpher(canvas, 80, 138);
        canvasMorpher.combineImages(canvas, p1, p2);
    }

/* Experiment procedures */
    /* block1: learning task */
    /* 1.1 learning: define learning trials*/
    var learn_A_passive = {
        type: jsPsychCanvasKeyboardResponse,
        canvas_size: [400, 900],
        stimulus: function(c) {
            Morphfunction(c, jsPsych.timelineVariable(`radius_a`), jsPsych.timelineVariable(`radius_b`));
        },
        prompt: jsPsych.timelineVariable(`prompt`),
        data: {
                stimuli_1: jsPsych.timelineVariable(`radius_a`),
                stimuli_2: jsPsych.timelineVariable(`radius_b`)
            },
      };

     var learn_A_active = {
        type: jsPsychCanvasButtonResponse,
        canvas_size: [400, 900],
        choices: [`<p style="font-size:20px;font-weight:bold;">The right one is more ${A}.</p>`, `<p style="font-size:20px;font-weight:bold;">The right one is more ${B}.</p>`, `<p style="font-size:20px;font-weight:bold;">They are the same.</p>`],
        stimulus: function(c) {
            Morphfunction(c, jsPsych.timelineVariable(`radius_a`), jsPsych.timelineVariable(`radius_b`));
        },
        response_ends_trial: true,
        data: {
                task: `block1_active_response`,
                stimuli_1: jsPsych.timelineVariable(`radius_a`),
                stimuli_2: jsPsych.timelineVariable(`radius_b`),
                correct_response: jsPsych.timelineVariable(`correct_response`)
            },
        on_finish: function(data){
                         // Score the response as correct or incorrect.
                         if(jsPsych.data.get().last(1).values()[0].response != jsPsych.data.get().last(1).values()[0].correct_response){
                           data.wrong = false;
                         } else {
                           data.wrong = true;
                         }
        }
      };

      var looped_A_active = {
        timeline: [learn_A_active],
        loop_function: function(data){
          if (jsPsych.data.get().last(1).values()[0].response != jsPsych.data.get().last(1).values()[0].correct_response){
            alert(`Nope, let\`s try again!`);
            return true;
            //jsPsych.resumeExperiment(learn_A_2b); // Resume the experiment
          } else{
            alert(`Yes! Great job!`);
            return false;
          }
        }
      };

      var test = {
         type: jsPsychCanvasButtonResponse,
         canvas_size: [400, 900],
         choices: [`<p style="font-size:20px;font-weight:bold;">The right one is more A.</p>`, `<p style="font-size:20px;font-weight:bold;">The right one is more ${B}.</p>`, `<p style="font-size:20px;font-weight:bold;">They are the same.</p>`],
         stimulus: function(c) {
             Morphfunction(c, jsPsych.timelineVariable(`radius_a`), jsPsych.timelineVariable(`radius_b`));
         },
         response_ends_trial: true,
         data: {
                 task: `test_response`,
                 correct_response: jsPsych.timelineVariable(`correct_response`),
                 stimuli_1: (jsPsych.timelineVariable(`radius_a`)),
                 stimuli_2: (jsPsych.timelineVariable(`radius_b`)),
             },
        on_finish: function(data){
                     // Score the response as correct or incorrect.
                     if(jsPsych.data.get().last(1).values()[0].response != jsPsych.data.get().last(1).values()[0].correct_response){
                       data.wrong = false;
                     } else {
                       data.wrong = true;
                     }
         }
       };

       var learn_C_active = {
          type: jsPsychCanvasButtonResponse,
          canvas_size: [400, 900],
          stimulus: function(c) {
              Morphfunction(c, jsPsych.timelineVariable(`radius_a`), jsPsych.timelineVariable(`radius_b`));
          },
          prompt: jsPsych.timelineVariable(`prompt`),
          choices: [`<p style="font-size:20px;font-weight:bold;">  0  </p>`, `<p style="font-size:20px;font-weight:bold;">1</p>`, `<p style="font-size:20px;font-weight:bold;">2</p>`, `<p style="font-size:20px;font-weight:bold;">3</p>`, `<p style="font-size:20px;font-weight:bold;">4</p>`],
          response_ends_trial: true,
          data: {
                  task: `block2_active_response`,
                  correct_response: jsPsych.timelineVariable(`correct_response`),
                  stimuli_1: (jsPsych.timelineVariable(`radius_a`)),
                  stimuli_2: (jsPsych.timelineVariable(`radius_b`)),
              },
          on_finish: function(data){
                  // Score the response as correct or incorrect.
                  if(jsPsych.data.get().last(1).values()[0].response != jsPsych.data.get().last(1).values()[0].correct_response){
                    data.wrong = false;
                  } else {
                    data.wrong = true;
                  }
                }
        };

        var looped_C_active = {
          timeline: [learn_C_active],
          loop_function: function(data){
            if(jsPsych.data.get().last(1).values()[0].response != jsPsych.data.get().last(1).values()[0].correct_response){
              alert(`Nope, let\`s try again!`);
              return true;
              //jsPsych.resumeExperiment(learn_A_2b); // Resume the experiment
            } else{
              alert(`Yes! Great job!`);
              return false;
            }
          }
        };

        var test_equally = {
           type: jsPsychCanvasButtonResponse,
           canvas_size: [400, 900],
           choices: [`<p style="font-size:20px;font-weight:bold;">The right one is more ${A}.</p>`, `<p style="font-size:20px;font-weight:bold;">The right one is more ${B}.</p>`, `<p style="font-size:20px;font-weight:bold;">They are equally ${A}.</p>`, `<p style="font-size:20px;font-weight:bold;">They are equally ${B}.</p>`],
           stimulus: function(c) {
               Morphfunction(c, jsPsych.timelineVariable(`radius_a`), jsPsych.timelineVariable(`radius_b`));
           },
           response_ends_trial: true,
           data: {
                   task: `test_response`,
                   correct_response: jsPsych.timelineVariable(`correct_response`),
                   stimuli_1: (jsPsych.timelineVariable(`radius_a`)),
                   stimuli_2: (jsPsych.timelineVariable(`radius_b`)),
               },
          on_finish: function(data){
                       // Score the response as correct or incorrect.
                       if(jsPsych.data.get().last(1).values()[0].response != jsPsych.data.get().last(1).values()[0].correct_response){
                         data.wrong = false;
                       } else {
                         data.wrong = true;
                       }
           }
         };

         var real_adj = {
             type: jsPsychImageButtonResponse,
             stimulus: jsPsych.timelineVariable(`stimulus`),
             stimulus_height: 400,
             choices: function() {
               var word = jsPsych.timelineVariable('word');
               var antonym = jsPsych.timelineVariable('antonym');
               return [
                  `The right one is ${word}er.`,
                  `The right one is ${antonym}.`,
                  `They are equally ${word}.`,
                  `They are equally ${antonym}.`
                ];
            },
         };



      /* define learning procedure*/
      // Block I: learning (passive + active)
      var learn_procedure_1 = {
        timeline: [instruction_break, learn_A_passive],
        timeline_variables:learn_stimuli_a1,
      };
      var learn_procedure_2 = {
        timeline: [instruction_break,looped_A_active],
        timeline_variables: learn_stimuli_a2,
        randomize_order: true,
      };
      // Block II: testing
      var test_procedure_1 = {
         timeline: [instruction_break, test],
         timeline_variables: test_stimuli,
         randomize_order: true,
       };
       // Block III: learning (passive + active)
       var learn_procedure_3 = {
         timeline: [instruction_break, learn_A_passive],
         timeline_variables:learn_stimuli_c1,
       };

       var learn_procedure_4 = {
         timeline: [instruction_break,looped_C_active],
         timeline_variables: learn_stimuli_c2,
         randomize_order: true,
       };
       // Block IV: testing
       var test_procedure_2 = {
          timeline: [instruction_break, test],
          timeline_variables: test_stimuli,
          randomize_order: true,
        };

      var test_procedure_3 = {
           timeline: [instruction_break, test_equally],
           timeline_variables: test_stimuli_2,
           randomize_order: true,
         };

     var survey = {
       timeline: [instruction_break, real_adj],
       timeline_variables: test_stimuli_3,
       randomize_order: true,
     }



    /*set the structure*/
    var timeline = [];
    timeline.push(welcome);
    /*block1*/
    timeline.push(instruction_1);
    timeline.push(learn_procedure_1);
    timeline.push(instruction_2);
    timeline.push(learn_procedure_2);

    /*block2*/
    timeline.push(instruction_3);
    timeline.push(test_procedure_1);


    /*block3*/
    timeline.push(instruction_4);
    timeline.push(learn_procedure_3);
    timeline.push(instruction_5);
    timeline.push(learn_procedure_4);

    /*block4*/
    timeline.push(instruction_6);
    timeline.push(test_procedure_2);
    timeline.push(instruction_7);
    timeline.push(test_procedure_3);

    /*survey*/
    timeline.push(instruction_8);
    timeline.push(survey);

    //Follow-up trial with real adjectives

    timeline.push(closing);

    /* start the experiment */
    jsPsych.run(timeline);

  </script>
</html>
